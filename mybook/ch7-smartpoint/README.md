
# 智能指针

## 概念

行为和指针相似,并且有额外的元数据,和额外的功能.
一句话，可以像指针一样操作这个结构。

`String` 就是一个智能指针. 因为实现了`Drop Reref Trait`,
他们内部拥有数据,并且可以像用指针那样来操作他,可以直接通过`*`来获取数据.


## Drop 和 Deref
`Drop trait` 是所有类型都有的,当对象所有权离开作用域就会被调用.
只有引用才有生命周期,然后通过生命周期去回收数据,回收的都是堆上的数据, 
回收的时候其实就是调用的`drop`,所以智能指针,也需要实现`drop trait`
这样才能回收, 并且任意类型都可是实现`drop`,不仅可以回收对象了,还可以一些收尾操作,
比如断开连接.但是不建议,除非是非常底层的代码为了更高的效率,否则还是以代码可读性和逻辑清晰为主.

`Deref trait` 是选择实现,如果想像操作指针那样操作这个对象,那么实现这个`trait`,主要是实现
`deref()`方法。
因为智能指针本身就拥有数据，理论上可以直接获取数据。
实现原理就是，我们解引用的时候调用`deref()`，如果里面的数据还是一个智能指针就调用`deref()`。